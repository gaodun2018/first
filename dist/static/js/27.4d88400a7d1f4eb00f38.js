webpackJsonp([27],{uB74:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("HzJ8"),i=a.n(s),n=a("lC5x"),r=a.n(n),l=a("J0Oq"),o=a.n(l),c=a("4YfN"),d=a.n(c),u=a("yt7g"),m={components:{},data:function(){var t=this;return{active:0,checkList:[],CheckedList:[],CheckedIdList:[],progressText:[{text:"第一步：设置起始时间",currentLine:"bar-line-current",currentDot:"bar-dot-current",currentText:"current-text",isCustomerConfirm:!0},{text:"第二步：选择学习内容",currentLine:"bar-line-current",currentDot:"bar-dot-current",currentText:"current-text",isCustomerConfirm:!1}],dialogFormVisible:!1,dialogVisible:!1,phaseForm:{},phaserules:{start_time:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],end_time:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}]},form:{},rules:{name:[{required:!0,message:"请输入班级标杆名称",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}]},classPlanTabValue:"1",classPlanTab:[],tabIndex:2,stagePlandData:[],classDetail:"",gradations:"",mocks:"",mockstitle:"",currentIndex:"",planphaseId:"",Doing:"change",pickerBeginDateBefore:{disabledDate:function(e){var a=t.phaseForm.end_time;if(a)return e.getTime()>a}},pickerBeginDateAfter:{disabledDate:function(e){var a=t.phaseForm.start_time;if(a)return e.getTime()<a}},tabid:"",tabname:"",phaseflag:!1,plandib:!1,TabLoading:!0}},computed:{course_id:function(){return this.$route.params.cid},class_id:function(){return this.$route.params.clid}},methods:{addTab:function(){this.form={name:""},this.dialogFormVisible=!0},addstagebtn:function(){this.Doing="add",this.active=0,this.phaseForm={start_time:"",end_time:"",target:""},this.checkList=[],this.CheckedList=[],this.dialogVisible=!0},handleClick:function(t){this.classPlanTabValue=t.name,this.stagePlandData=this.classPlanTab[Number(t.index)].plan?this.classPlanTab[Number(t.index)].plan.plan_item:[],this.tabname=t.name,this.tabid=t.index},handleCheckedCitiesChange:function(t){console.log(t);for(var e=[],a=0;a<t.length;a++)if(/^0#/.test(t[a]))for(var s=0;s<this.mocks.length;s++)"0#"+this.mocks[s].mock.id==t[a]&&e.push(this.mocks[s].mock.title);else for(var i=0;i<this.gradations.length;i++)for(var n=0;n<this.gradations[i].syllabus.contents.length;n++){this.gradations[i].syllabus.id+"#"+this.gradations[i].syllabus.contents[n].id==t[a]&&e.push(this.gradations[i].syllabus.contents[n].title)}this.CheckedList=[].concat(e)},formatTime:function(t){return new Date(t)},handleEdit:function(t,e){this.Doing="change",this.active=0;for(var a=[],s=[],i=this.stagePlandData[t].phase,n=0;n<i.length;n++)for(var r=i[n].syllabus_id,l=i[n].item,o=0;o<l.length;o++)a.push(r+"#"+l[o].id),s.push(l[o].name);this.planphaseId=e.plan_item_id,this.phaseForm=d()({},this.stagePlandData[t]),this.phaseForm.start_time=this.formatTime(this.phaseForm.start_time),this.phaseForm.end_time=this.formatTime(this.phaseForm.end_time),this.checkList=a,this.CheckedList=s,this.currentIndex=t,this.dialogVisible=!0},resetForm:function(t){this.$refs[t].resetFields()},next:function(t){var e=this;this.active>=this.progressText.length-1||this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;e.active++,e.progressText[e.active].isCustomerConfirm=!0})},prev:function(){this.active<=0||(this.progressText[this.active].isCustomerConfirm=!1,this.active--)},getClassPlanDetail:function(t,e){var a=this;return o()(r.a.mark(function s(){var i;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,a.$http.getClassPlanDetail(a.class_id);case 2:0==(i=s.sent).data.status&&(a.classDetail=i.data.result.class,a.classPlanTab=i.data.result.plan,a.classPlanTabValue=t||0!=i.data.result.plan.length&&i.data.result.plan[0].id,t?(console.log("kkksdsdfsdf"),a.stagePlandData=a.classPlanTab[Number(e)].plan?a.classPlanTab[Number(e)].plan.plan_item:[]):a.classPlanTab&&a.classPlanTab.length>0&&a.classPlanTab[Number(a.tabid)].plan&&i.data.result.plan[0].plan.plan_item.length>0?a.stagePlandData=i.data.result.plan[0].plan.plan_item:(a.stagePlandData=[],console.log("内容为空")),a.TabLoading=!1);case 4:case"end":return s.stop()}},s,a)}))()},submitTab:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;var a=!0,s=!0,n=!1,r=void 0;try{for(var l,o=i()(e.classPlanTab);!(s=(l=o.next()).done);s=!0){if(l.value.plan_name==e.form.name)return e.$message.error("此标杆计划名称已存在！"),a=!1,!1}}catch(t){n=!0,r=t}finally{try{!s&&o.return&&o.return()}finally{if(n)throw r}}1==a&&(console.log("添加成功！"),e.addClassPlan(e.form.name),e.dialogFormVisible=!1)})},deleteClassPlan:function(){var t=this;return o()(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$http.deleteClassPlan("1");case 2:e.sent;case 3:case"end":return e.stop()}},e,t)}))()},deletePlanPhase:function(t,e){var a=this;this.$confirm("此操作将删除该阶段计划, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.deletePlanPhase(e.plan_item_id).then(function(t){1==t.data.result?(a.$message({type:"success",message:"删除成功!"}),a.getClassPlanDetail(a.tabname,a.tabid)):1==t.data.result&&a.$message.error("删除失败")})}).catch(function(){a.$message({type:"info",message:"已取消删除"})})},addClassPlan:function(t){var e=this;return o()(r.a.mark(function a(){var s;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e.phaseflag=!0,a.next=3,e.$http.addClassPlan({plan_name:t,class_id:e.class_id});case 3:0==(s=a.sent).status&&(1==s.result?(e.$message({message:"创建成功",type:"success"}),e.getClassPlanDetail()):0==s.result?e.$message.error("创建失败"):e.$message({message:s.result,type:"warning"}),e.phaseflag=!1);case 5:case"end":return a.stop()}},a,e)}))()},changePhase:function(t){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.plandib=!0,!(e.CheckedList.length>0)){t.next=8;break}return t.next=4,e.$http.changePhase({start_time:Object(u.a)(e.phaseForm.start_time),end_time:Object(u.a)(e.phaseForm.end_time),target:e.phaseForm.target,"content[]":e.checkList,plan_id:e.classPlanTabValue,class_id:e.class_id,id:"change"==e.Doing?e.planphaseId:""});case 4:0==(a=t.sent).status&&(1==a.result?(e.$message({message:"change"==e.Doing?"修改成功":"创建成功",type:"success"}),e.dialogVisible=!1,e.getClassPlanDetail(e.tabname,e.tabid)):0==a.result?e.$message.error("change"==e.Doing?"修改失败":"创建失败"):e.$message({message:a.result,type:"warning"}),e.plandib=!1),t.next=10;break;case 8:e.$message({message:"请选择章节",type:"warning"}),e.plandib=!1;case 10:case"end":return t.stop()}},t,e)}))()},getCourseOutline:function(){var t=this;return o()(r.a.mark(function e(){var a,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.course_id,e.next=3,t.$http.getCourseOutline(a);case 3:0==(s=e.sent).data.status&&0!=s.data.result&&(t.gradations=s.data.result.gradations,t.mocks=s.data.result.mocks,t.mockstitle=s.data.result.mocks&&0!=s.data.result.mocks.length&&s.data.result.mocks[0].title);case 5:case"end":return e.stop()}},e,t)}))()}},created:function(){this.getClassPlanDetail(),this.getCourseOutline()},mounted:function(){}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"title",rawName:"v-title"}],staticClass:"customized",attrs:{"data-title":"EP课程学习数据统计"}},[a("div",{staticClass:"student-header headbar"},[a("div",{staticClass:"w_1140 p_t_36 clear "},[a("div",{staticClass:"student-head_l head_l"},[a("p",{staticClass:"white_12 stu_cou_group",staticStyle:{"letter-spacing":"1px"}},[t._v(t._s(t.classDetail.course_name))]),t._v(" "),a("p",{staticClass:"student_tit white_24"},[a("span",{staticClass:"studentName white_24",attrs:{"show-overflow-tooltip":"true"}},[t._v(t._s(t.classDetail.class_name))])])])])]),t._v(" "),a("div",{staticClass:"tabmenu"},[a("div",{staticClass:"w_1140"},[a("div",{staticClass:"tabs"},[a("div",{staticClass:"tabs_nav"},[a("div",{staticClass:"tabs_item is-active"},[t._v("制定班级学习计划")]),t._v(" "),a("div",{staticClass:"tabs_item"},[a("router-link",{attrs:{to:"/choosePlan/"+t.course_id+"/"+t.class_id}},[t._v("为学员选择学习计划")])],1)])])])]),t._v(" "),a("div",{staticClass:"addPlanbox"},[a("div",{staticClass:"w_1140 clear"},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClick},model:{value:t.classPlanTabValue,callback:function(e){t.classPlanTabValue=e},expression:"classPlanTabValue"}},t._l(t.classPlanTab,function(t){return a("el-tab-pane",{key:t.id,attrs:{label:t.name,name:t.id}})})),t._v(" "),a("el-button",{staticClass:"addPlanbtn",attrs:{type:"primary",icon:"plus"},on:{click:function(e){t.addTab(t.editableTabsValue2)}}},[t._v("新建一套班级标杆\n       ")])],1)]),t._v(" "),a("el-dialog",{attrs:{title:"新建一套班级标杆",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e},close:function(e){t.resetForm("ruleForm")}}},[a("el-form",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"班级标杆名称",prop:"name"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{"auto-complete":"off"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.submitTab("ruleForm")}},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name","string"==typeof e?e.trim():e)},expression:"form.name"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",disabled:t.phaseflag},on:{click:function(e){t.submitTab("ruleForm")}}},[t._v("确 定")])],1)],1),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.TabLoading,expression:"TabLoading"}],staticClass:"stulists_mian",attrs:{"element-loading-text":"拼命加载中..."}},[a("div",{staticClass:"w_1140"},[a("el-table",{ref:"word",staticClass:"stuTableData",attrs:{data:t.stagePlandData,border:!1}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"70"}}),t._v(" "),a("el-table-column",{attrs:{prop:"start_time",label:"阶段开始时间",width:"130"}}),t._v(" "),a("el-table-column",{attrs:{prop:"end_time",label:"阶段结束时间",width:"130"}}),t._v(" "),a("el-table-column",{attrs:{prop:"phase",label:"阶段学习内容",width:"360","show-overflow-tooltip":"true"}},[t._l(t.scope.row.phase,function(e,s){return a("span",{key:s},t._l(e.item,function(s,i){return a("span",{key:i},[t._v(t._s(e.type)+" - "+t._s(s.name)+"，")])}))})],2),t._v(" "),a("el-table-column",{attrs:{prop:"target",label:"阶段学习目标",width:"300","show-overflow-tooltip":"true"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"custarrow"},[t._v(t._s(e.row.target))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"removebtn",attrs:{type:"text"},on:{click:function(a){t.deletePlanPhase(e.$index,e.row)}}},[t._v("删除")]),t._v(" "),a("el-button",{staticClass:"editbtn",attrs:{type:"text"},on:{click:function(a){t.handleEdit(e.$index,e.row)}}},[t._v("修改")])]}}])})],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:0!=t.classPlanTab.length,expression:"classPlanTab.length!=0"}],staticClass:"addstagebox"},[a("div",{staticClass:"addstagebtn",on:{click:t.addstagebtn}},[a("i",{staticClass:"el-icon-plus"}),t._v(" "),a("el-button",{attrs:{type:"text"}},[t._v("新增一个阶段学习计划")])],1)])],1)]),t._v(" "),a("el-dialog",{staticClass:"plandialog",attrs:{title:"新增一个阶段学习计划",visible:t.dialogVisible,top:"10%","modal-append-to-body":"true"},on:{"update:visible":function(e){t.dialogVisible=e},close:function(e){t.resetForm("phaseForm")}}},[a("el-row",{staticClass:"progressBox"},t._l(t.progressText,function(e){return a("el-col",{key:e.text,attrs:{sm:12}},[a("div",{staticClass:"order-progress-bar"},[a("i",{staticClass:"progress-bar-line",class:e.isCustomerConfirm?e.currentLine:""}),t._v(" "),a("i",{staticClass:"progress-bar-dot",class:e.isCustomerConfirm?e.currentDot:""}),t._v(" "),a("span",{class:e.isCustomerConfirm?e.currentText:""},[t._v(t._s(e.text))])])])})),t._v(" "),a("el-form",{directives:[{name:"show",rawName:"v-show",value:0==t.active,expression:"active==0"}],ref:"phaseForm",staticStyle:{"margin-top":"30px"},attrs:{model:t.phaseForm,rules:t.phaserules,"label-width":"80px"}},[a("el-form-item",{staticStyle:{display:"inline-block",width:"49%"},attrs:{label:"开始时间",prop:"start_time"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd",type:"date",placeholder:"选择开始时间","picker-options":t.pickerBeginDateBefore},model:{value:t.phaseForm.start_time,callback:function(e){t.$set(t.phaseForm,"start_time",e)},expression:"phaseForm.start_time"}})],1),t._v(" "),a("el-form-item",{staticStyle:{display:"inline-block",width:"49%"},attrs:{label:"结束时间",prop:"end_time"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd",type:"date",placeholder:"选择结束时间","picker-options":t.pickerBeginDateAfter},model:{value:t.phaseForm.end_time,callback:function(e){t.$set(t.phaseForm,"end_time",e)},expression:"phaseForm.end_time"}})],1),t._v(" "),a("el-form-item",{staticClass:"fromtxt",attrs:{label:"阶段学习目标（选填）",prop:"target"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.phaseForm.target,callback:function(e){t.$set(t.phaseForm,"target",e)},expression:"phaseForm.target"}})],1),t._v(" "),a("el-form-item",{staticStyle:{"text-align":"right","margin-right":"10px"}},[a("el-button",{on:{click:function(e){t.next("phaseForm")}}},[t._v("下一步")])],1)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.active,expression:"active==1"}],staticClass:"choose-resourse"},[a("div",{staticClass:"selected"},[a("span",{staticStyle:{float:"left"}},[t._v("已选择：")]),t._v(" "),t._l(t.CheckedList,function(e,s){return a("span",{key:s,staticClass:"checkeditem"},[t._v(t._s(e))])})],2),t._v(" "),a("div",{staticClass:"resourcebox"},[a("el-checkbox-group",{attrs:{min:1},on:{change:t.handleCheckedCitiesChange},model:{value:t.checkList,callback:function(e){t.checkList=e},expression:"checkList"}},[t._l(t.gradations,function(e){return a("div",{key:e.id},[a("div",{staticClass:"resourcetit"},[a("p",[t._v(t._s(e.title))])]),t._v(" "),a("div",{staticClass:"checkbox"},t._l(e.syllabus.contents,function(s,i){return a("el-checkbox",{key:i,attrs:{label:e.syllabus.id+"#"+s.id}},[t._v(t._s(s.title)+"\n               ")])}))])}),t._v(" "),0!=t.mocks.length?a("div",[a("div",{staticClass:"resourcetit"},[a("p",[t._v(t._s(t.mockstitle))])]),t._v(" "),a("div",{staticClass:"checkbox"},t._l(t.mocks,function(e,s){return a("el-checkbox",{key:s,attrs:{label:"0#"+e.mock.id}},[t._v(t._s(e.mock.title)+"\n               ")])}))]):t._e()],2)],1),t._v(" "),a("div",{staticClass:"choose-footer"},[a("el-button",{on:{click:t.prev}},[t._v("上一步")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.plandib},on:{click:t.changePhase}},[t._v("确定")])],1)])],1)],1)},staticRenderFns:[]},p=a("Z0/y")(m,h,!1,null,null,null);e.default=p.exports}});
//# sourceMappingURL=27.4d88400a7d1f4eb00f38.js.map