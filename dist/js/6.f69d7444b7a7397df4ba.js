webpackJsonp([6],{HOTG:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Xxa5"),s=r.n(a),i=r("exGp"),n=r.n(i),o=r("DAYN"),l=r.n(o),c=r("y1EW"),u=r("yt7g"),d=r("YP0r"),p=r("uqXn"),m={name:"SyllabusModuleEdit",components:{draggable:l.a,HandoutUpload:d.a,SelectKnowledge:p.a},data:function(){return{audition:0,startType:"",endType:"",liveid:0,resourceid:"",syllabusid:"",valiMinites:[{validator:function(e,t,r){(t=Number(t))>999?r(new Error("时长不允许超过三位数")):r()},trigger:"blur"}],valiSeconds:[{validator:function(e,t,r){Number(t)>60?r(new Error("秒数最大不允许超过60")):r()},trigger:"blur"}],judgeid:"",knowledgeInfo:"",project_id:"",subject_id:"",isAllowUse:0,btnLoading:!1,active:0,resourceRadio:"",selectType:"",nativeResourceRadio:"",ResIsInOutline:!1,resourceTableConfig:[],radio1:1,radio2:4,tabledata:[],progressText:c.a,addResFirFrom:{name:"",type:"",required:"",start_time:"",study_time:"",apply_to:[]},study_time_options:[],ruleProject:{name:""},dialogFormVisible:!1,resourceTable:[],multipleSelection:[],dialogVisible:!1,adddialogVisible:!1,Moduledialog:!0,bigdislog:!1,deleteModule:!0,resourceType:"video",inputPlaceholder:"请输入视频资源ID / 名称",refname:"",coursesylllevel:"",currentId:"0",title:"",tag_id:"",resourceAction:"add",pagination:{current_page:1,total:1},resLoading:!1,resourceinput:"",searchResourceTimer:"",sortOptions:"",sourceRadio:1,handoutForm:{path:"",size:""},videoForm:{title:"",video_id:"",duration_minutes:"",duration_second:""},urltip:'[<script src="https://s.gaodun.com/web/static-player/loader.js?',urltip2:'-3" type="text/javascript"><\/script>]',currentSyllabusItemKnowledge:"",openArr:[],erjiCourseOptions:[],erjicourseId:null,delLoading:!1,onlySetLoading:!1,showAddGliveDialog:!1,showAddGliveDialog1:!1,gliveAddr:"",gliveAddr1:"",gliveAddr2:"",hasType2:!0,timeVali:!0,playBackItem:"",resourceItemId:"",itemResourceId:"",itemResourceInfo:{}}},filters:{typeFormat:function(e){switch(+e){case 1:return"课前";case 2:return"课中";case 3:return"课后"}},requiredFormat:function(e){switch(+e){case 1:return"必修";case 2:default:return"选修"}},dateFormat:function(e){var t=new Date(e),r=t.toLocaleDateString().replace(/\//g,"/")+" "+t.toTimeString().substr(0,8);return r.substring(0,r.length-3)}},methods:{directSyllabus:function(e){var t,r=this;this.$refs[e].validate((t=n()(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return r.onlySetLoading=!0,e.next=4,r.CourseSyllabusItem();case 4:0==e.sent.status?(r.onlySetLoading=!1,r.dialogFormVisible=!1,r.getSyllabusItems(),r.$message({message:"创建条目成功",type:"success"})):r.$message({message:"直接创建条目失败请联系管理员",type:"success"}),e.next=9;break;case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,r)})),function(e){return t.apply(this,arguments)}))},directChangeSyllabus:function(e){var t,r=this;this.$refs[e].validate((t=n()(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return r.onlySetLoading=!0,e.next=4,r.ChangeSyllabusItem();case 4:0==e.sent.status?(r.onlySetLoading=!1,r.dialogFormVisible=!1,r.getSyllabusItems(),r.$message({message:"修改条目成功",type:"success"})):r.$message({message:"直接修改条目失败请联系管理员",type:"success"}),e.next=9;break;case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,r)})),function(e){return t.apply(this,arguments)}))},handleSpread:function(e){e.cancelBubble=!0},spread:function(e){var t=this;console.log(this.openArr),this.openArr.includes(e.id)?this.openArr.forEach(function(r,a){e.id==r&&t.openArr.splice(a,1)}):this.openArr.push(e.id)},changePreWatch:function(e){var t=this;return n()(s.a.mark(function r(){var a,i,n;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=1==e.audition?0:1,i={audition:a,name:e.name,course_syllabus_id:t.syllabus_id},r.next=4,t.$http.ChangeSyllabusItem(e.id,i);case 4:0===r.sent.status?(n=0==a?"已关闭试听":"已设置试听",t.$message({message:n,type:"success"}),setTimeout(function(){t.getSyllabusItems()},800)):t.$message({message:"设置试听失败，请联系管理员",type:"warning"});case 6:case"end":return r.stop()}},r,t)}))()},goPreview:function(e){if(e.resource)if("video"===e.resource.discriminator){var t=this.$router.resolve({name:"previewVideo",params:{id:e.resource_id}});window.open(t.href,"_blank")}else if("resource_group"===e.resource.discriminator){var r=this.$router.resolve({name:"editResourceGroup",params:{id:e.resource_id}});window.open(r.href,"blank")}else this.$message({message:"该类型资源暂时不支持预览",type:"warning"});else this.$message({message:"此条目未挂资源",type:"warning"})},handleInputMinutesChange:function(e){var t=this;this.$nextTick(function(){t.videoForm.duration_minutes=t.videoForm.duration_minutes.replace(/[^\d]/g,"")})},handleInputSecondChange:function(e){var t=this;this.$nextTick(function(){t.videoForm.duration_second=t.videoForm.duration_second.replace(/[^\d]/g,"")})},copyId:function(e,t){var r=document.createElement("input");if(t){if(!t.resource)return void this.$message({message:"您还没有挂资源",type:"warning"});r.value=e+","+t.resource_id}else r.value=e;document.body.appendChild(r),r.select(),document.execCommand("Copy"),r.className="oInput",r.style.display="none",this.$message({message:"已将ID复制到剪贴板",type:"success"})},handleTableChange:function(e){e&&(this.resourceid=e.id,this.endType=e.discriminator,this.resourceRadio=String(e.id))},selectclk:function(e){this.addResFirFrom.apply_to=[],this.addResFirFrom.study_time="",this.resourceType=e},openAddResDialog:function(e){var t=this;return n()(s.a.mark(function r(){return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$http.getValidation({parent_id:e.id});case 2:r.sent.result.Has&&(t.hasType2=!1),t.currentId=e.id,t.syllabusid=e.course_syllabus_id,t.active=0,t.addResFirFrom.name="",t.addResFirFrom.type="",t.addResFirFrom.required="",t.addResFirFrom.start_time="",t.addResFirFrom.study_time="",t.addResFirFrom.apply_to=[],t.resourceRadio="",t.resourceType="video",t.nativeResourceRadio="",t.dialogFormVisible=!0,t.resourceAction="add";case 18:case"end":return r.stop()}},r,t)}))()},firstNextSubmit:function(e){var t,r=this;this.$refs[e].validate((t=n()(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}if(!(r.active>=r.progressText.length-1)){e.next=3;break}return e.abrupt("return");case 3:r.active++,e.next=7;break;case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}},e,r)})),function(e){return t.apply(this,arguments)}))},secondSubmit:function(e){var t=this;return n()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(2!=t.addResFirFrom.type||t.addResFirFrom.start_time){e.next=2;break}return e.abrupt("return",t.$message.error("请设置开启时间！"));case 2:if(t.resourceType){e.next=7;break}return t.$message.warning("请选择资源类型！"),e.abrupt("return");case 7:"lecture_note"===t.resourceType?(t.handoutForm.path="",t.$refs.handoutUpload.clearAllFileList()):"video"===t.resourceType&&t.resetForm("videoForm");case 8:if(!(t.active>=t.progressText.length-1)){e.next=10;break}return e.abrupt("return");case 10:c.b.forEach(function(e){e.discriminator==t.resourceType&&(t.resourceTableConfig=e.table,t.inputPlaceholder=e.inputPlaceholder)}),t.active++,t.sourceRadio=2,t.resourceinput="",t.resourceTable=[],1!=t.pagination.current_page?t.pagination.current_page=1:t.searchResource();case 16:case"end":return e.stop()}},e,t)}))()},handleCurrentChange:function(e){var t=this;return n()(s.a.mark(function r(){return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e=Number(e),t.searchResource(e);case 2:case"end":return r.stop()}},r,t)}))()},handleIconClick:function(){var e=this;return n()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:1!=e.pagination.current_page?e.pagination.current_page=1:e.searchResource();case 1:case"end":return t.stop()}},t,e)}))()},searchResource:function(e){var t=this;clearTimeout(this.searchResourceTimer),this.resLoading=!0,this.searchResourceTimer=setTimeout(n()(s.a.mark(function r(){var a,i,n;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:clearTimeout(t.searchResourceTimer),a={discriminator:t.resourceType,page_size:50,page:e||1,"order_by[]":"desc","order_by_field[]":"id",project_id:t.project_id},i=t.resourceinput.trim(),r.t0=t.resourceType,r.next="legacy_live"===r.t0?6:"paper"===r.t0?8:10;break;case 6:return Object(u.e)(i)?a.legacy_live_id=i:a.keywords=i,r.abrupt("break",12);case 8:return Object(u.e)(i)?a.paper_id=i:a.keywords=i,r.abrupt("break",12);case 10:return a.keywords=i,r.abrupt("break",12);case 12:return r.next=14,t.$http.getResource(a);case 14:0==(n=r.sent).status&&(t.resLoading=!1,t.resourceTable=n.result.resources,t.pagination.total=n.result.pagination.total);case 16:case"end":return r.stop()}},r,t)})),500)},prev:function(){this.active<=0||this.active--},handleSelectionChange:function(e){this.multipleSelection=e},addSyllabusResourceItem:function(e){var t=this;return n()(s.a.mark(function r(){var a,i,n,o;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!e||"live_playback_link"!=e){r.next=34;break}if(2!=t.addResFirFrom.type||t.addResFirFrom.start_time){r.next=3;break}return r.abrupt("return",t.$message.error("请设置开启时间！"));case 3:if(t.btnLoading=!0,"add"!==t.resourceAction){r.next=18;break}return r.next=7,t.CourseSyllabusItem();case 7:if((a=r.sent)&&(t.btnLoading=!1),0!=a.status){r.next=16;break}return t.dialogFormVisible=!1,i={syllabus_id:t.syllabus_id,item_id:a.result.id,relation_id:"-1",discriminator:"live_playback_link"},r.next=14,t.$http.updatePlaybackAddr(i);case 14:0==r.sent.code&&t.getSyllabusItems();case 16:r.next=32;break;case 18:if("update"!==t.resourceAction){r.next=32;break}return r.next=21,t.ChangeSyllabusItem();case 21:if((n=r.sent)&&(t.btnLoading=!1),0!=n.status){r.next=32;break}return t.dialogFormVisible=!1,o={syllabus_id:t.syllabus_id,item_id:n.result.id,relation_id:t.itemResourceId||"-1",discriminator:"live_playback_link"},t.itemResourceInfo.video_id&&(o.video_id=t.itemResourceInfo.video_id),t.itemResourceInfo.inst_replay&&(o.inst_replay=t.itemResourceInfo.inst_replay),r.next=30,t.$http.updatePlaybackAddr(o);case 30:0==r.sent.code&&t.getSyllabusItems();case 32:r.next=35;break;case 34:2===t.sourceRadio?t.sourceRadio2Syllabus():1===t.sourceRadio&&t.sourceRadio1Syllabus();case 35:case"end":return r.stop()}},r,t)}))()},sourceRadio2Syllabus:function(){var e=this;return n()(s.a.mark(function t(){var r,a,i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.resourceRadio){t.next=2;break}return t.abrupt("return",e.$message({message:"请选择资源",type:"warning"}));case 2:return e.btnLoading=!0,r=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.2)"}),t.next=6,e.checkResIsInOutline();case 6:if(t.sent){t.next=11;break}return e.btnLoading=!1,r.close(),t.abrupt("return");case 11:if(a=void 0,"add"!==e.resourceAction){t.next=18;break}return t.next=15,e.CourseSyllabusItem();case 15:a=t.sent,t.next=22;break;case 18:if("update"!==e.resourceAction){t.next=22;break}return t.next=21,e.ChangeSyllabusItem();case 21:a=t.sent;case 22:if(i=void 0,0!==a.status){t.next=43;break}return i=a.result.id,t.next=27,e.mountSyllabusResource(i);case 27:if(!e.resourceid||"add"!==e.resourceAction){t.next=33;break}if("legacy_live"!==e.endType){t.next=33;break}return t.next=31,e.$http.changeLive(0,e.resourceid,e.syllabusid);case 31:0!=t.sent.status&&e.message({message:"预约直播失败,请联系管理员",type:"warning"});case 33:if(!e.resourceid||"update"!==e.resourceAction){t.next=39;break}if("legacy_live"!==e.endType&&"legacy_live"!==e.startType){t.next=39;break}return t.next=37,e.$http.changeLive(e.liveid,e.resourceid,e.syllabusid);case 37:0!=t.sent.status&&e.message({message:"预约直播失败，请联系管理员",type:"warning"});case 39:e.btnLoading=!1,r.close(),t.next=46;break;case 43:return e.btnLoading=!1,r.close(),t.abrupt("return");case 46:case"end":return t.stop()}},t,e)}))()},sourceRadio1Syllabus:function(){var e=this;"lecture_note"===this.resourceType?this.lectureSourceCreateIntoSyllabus():"video"===this.resourceType&&this.$refs.videoForm.validate(function(t){t&&e.videoSourceCreateIntoSyllabus()})},videoSourceCreateIntoSyllabus:function(){var e=this;return n()(s.a.mark(function t(){var r,a,i,n,o,l,c;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.btnLoading=!0,r=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.2)"}),t.next=4,e.getVideoPath();case 4:if(a=t.sent,i="",0!==a.status){t.next=14;break}if(a.result.video_id){t.next=11;break}return e.btnLoading=!1,r.close(),t.abrupt("return",e.$message({type:"warning",message:"视频地址解析失败！"}));case 11:i=a.result.video_id,t.next=21;break;case 14:if(1!=a.status){t.next=18;break}i=e.videoForm.video_id,t.next=21;break;case 18:return e.btnLoading=!1,r.close(),t.abrupt("return",e.$message({type:"warning",message:"视频地址解析失败！"}));case 21:return n={title:e.addResFirFrom.name,tag_payload_id:"0"==e.subject_id?e.project_id:e.subject_id,tag_payload_type:"0"==e.subject_id?"project":"subject",duration_minutes:e.videoForm.duration_minutes,duration_seconds:e.videoForm.duration_second?e.videoForm.duration_second:0,video_id:i},t.next=24,e.$http.createSyllabusVideoResource(n);case 24:if(0!==(o=t.sent).status){t.next=60;break}t.prev=26,e.resourceRadio=o.result.resource.id,t.next=35;break;case 30:return t.prev=30,t.t0=t.catch(26),e.btnLoading=!1,r.close(),t.abrupt("return",e.$message({message:"视频资源创建失败！",type:"error"}));case 35:if(l=void 0,"add"!==e.resourceAction){t.next=42;break}return t.next=39,e.CourseSyllabusItem();case 39:l=t.sent,t.next=46;break;case 42:if("update"!==e.resourceAction){t.next=46;break}return t.next=45,e.ChangeSyllabusItem();case 45:l=t.sent;case 46:if(c=void 0,0!==l.status){t.next=55;break}return c=l.result.id,t.next=51,e.mountSyllabusResource(c);case 51:e.btnLoading=!1,r.close(),t.next=58;break;case 55:return e.btnLoading=!1,r.close(),t.abrupt("return");case 58:t.next=63;break;case 60:return e.btnLoading=!1,r.close(),t.abrupt("return",e.$message({message:"视频资源创建失败！",type:"error"}));case 63:case"end":return t.stop()}},t,e,[[26,30]])}))()},lectureSourceCreateIntoSyllabus:function(){var e=this;return n()(s.a.mark(function t(){var r,a,i,n,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.handoutForm.path){t.next=2;break}return t.abrupt("return",e.$message({message:"请选择讲义上传！",type:"warning"}));case 2:return e.btnLoading=!0,r=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.2)"}),a={tag_payload_id:"0"==e.subject_id?e.project_id:e.subject_id,tag_payload_type:"0"==e.subject_id?"project":"subject",title:e.addResFirFrom.name,path:e.handoutForm.path,size:e.handoutForm.size},t.next=7,e.$http.saveLecturenote(a);case 7:if(0!==(i=t.sent).status){t.next=43;break}t.prev=9,e.resourceRadio=i.result.id,t.next=18;break;case 13:return t.prev=13,t.t0=t.catch(9),e.btnLoading=!1,r.close(),t.abrupt("return",e.$message({message:"讲义资源创建失败！",type:"error"}));case 18:if(n=void 0,"add"!==e.resourceAction){t.next=25;break}return t.next=22,e.CourseSyllabusItem();case 22:n=t.sent,t.next=29;break;case 25:if("update"!==e.resourceAction){t.next=29;break}return t.next=28,e.ChangeSyllabusItem();case 28:n=t.sent;case 29:if(o=void 0,0!==n.status){t.next=38;break}return o=n.result.id,t.next=34,e.mountSyllabusResource(o);case 34:e.btnLoading=!1,r.close(),t.next=41;break;case 38:return e.btnLoading=!1,r.close(),t.abrupt("return");case 41:t.next=46;break;case 43:return e.btnLoading=!1,r.close(),t.abrupt("return",e.$message({message:"讲义资源创建失败！",type:"error"}));case 46:case"end":return t.stop()}},t,e,[[9,13]])}))()},getHandoutPath:function(e){this.handoutForm.path=e.path,this.handoutForm.size=e.size},checkResIsInOutline:function(){var e=this;return n()(s.a.mark(function t(){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("update"!==e.resourceAction||e.nativeResourceRadio!=e.resourceRadio){t.next=2;break}return t.abrupt("return",!0);case 2:return t.next=4,e.$http.checkResIsInOutline(e.syllabus_id,e.resourceRadio);case 4:if(0!==(r=t.sent).status){t.next=15;break}if(!(r.result.length>0)){t.next=12;break}return e.resourceRadio="",e.$message({type:"error",message:"该资源已经挂载在这个大纲上！"}),t.abrupt("return",!1);case 12:return t.abrupt("return",!0);case 13:t.next=16;break;case 15:return t.abrupt("return",!1);case 16:case"end":return t.stop()}},t,e)}))()},CourseSyllabusItem:function(){var e=this;return n()(s.a.mark(function t(){var r,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r={name:e.addResFirFrom.name,pid:e.currentId,course_syllabus_id:e.syllabus_id,type:e.addResFirFrom.type,required:e.addResFirFrom.required},"0"!==e.addResFirFrom.study_time){t.next=3;break}return t.abrupt("return",e.$message({type:"error",message:"直播时长不能为0！"}));case 3:return e.addResFirFrom.study_time&&(r.study_time=e.addResFirFrom.study_time),e.addResFirFrom.start_time&&(r.start_time=e.addResFirFrom.start_time),void 0!=e.addResFirFrom.apply_to&&null!=e.addResFirFrom.apply_to&&0!==e.addResFirFrom.apply_to.length&&(r.apply_to=e.addResFirFrom.apply_to[0]),t.next=8,e.$http.CourseSyllabusItem(r);case 8:if(0!==(a=t.sent).status){t.next=13;break}return t.abrupt("return",a);case 13:return e.$message.error("添加失败！"),t.abrupt("return",a);case 15:case"end":return t.stop()}},t,e)}))()},ChangeSyllabusItem:function(){var e=this;return n()(s.a.mark(function t(){var r,a,i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.currentId,e.resourceType&&"video"!=e.resourceType&&(e.audition=0),a={name:e.addResFirFrom.name,course_syllabus_id:e.syllabus_id,audition:e.audition,type:e.addResFirFrom.type,required:e.addResFirFrom.required,study_time:e.addResFirFrom.study_time},"0"!==e.addResFirFrom.study_time){t.next=7;break}return t.abrupt("return",e.$message({type:"error",message:"直播时长不能为0！"}));case 7:e.addResFirFrom.study_time||(a.study_time=0);case 8:return e.addResFirFrom.start_time&&(a.start_time=e.addResFirFrom.start_time),void 0!=e.addResFirFrom.apply_to&&null!=e.addResFirFrom.apply_to&&0!==e.addResFirFrom.apply_to.length&&(a.apply_to=e.addResFirFrom.apply_to[0]),t.next=12,e.$http.ChangeSyllabusItem(r,a);case 12:if(0!==(i=t.sent).status){t.next=17;break}return t.abrupt("return",i);case 17:return e.$message.error("添加失败！"),t.abrupt("return",i);case 19:case"end":return t.stop()}},t,e)}))()},mountSyllabusResource:function(e){var t=this;return n()(s.a.mark(function r(){var a,i;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a={resource_id:t.resourceRadio,tag_id:t.tag_id,course_syllabus_id:t.syllabus_id},r.next=3,t.$http.mountSyllabusResource(e,a);case 3:0===(i=r.sent).status?(t.$message({type:"success",message:"add"===t.resourceAction?"新增资源成功！":"修改资源成功！"}),t.dialogFormVisible=!1,t.getSyllabusItems()):2===i.status&&t.$message({message:"add"===t.resourceAction?"新增资源失败！":"修改资源失败！",type:"error"});case 5:case"end":return r.stop()}},r,t)}))()},updateSyllabusResource:function(){var e=this;return n()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:2===e.sourceRadio?e.sourceRadio2Syllabus():1===e.sourceRadio&&e.sourceRadio1Syllabus();case 1:case"end":return t.stop()}},t,e)}))()},openeEditResource:function(e,t){var r=this;return n()(s.a.mark(function a(){return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r.resourceItemId=t.id,r.itemResourceId=t.resource_id,r.itemResourceInfo=t.resource,a.next=5,r.$http.getValidation({parent_id:e});case 5:a.sent.result.Has&&2!=t.type&&(r.hasType2=!1),r.currentId=e,r.syllabusid=t.course_syllabus_id,r.startType=t.resource?t.resource.discriminator:"",t.resource&&"legacy_live"===t.resource.discriminator?r.liveid=t.resource.live_id:r.liveid=0,r.audition=t.audition?t.audition:0,r.active=0,r.addResFirFrom.name=t.name,r.addResFirFrom.type=+t.type,r.addResFirFrom.required=+t.required,r.addResFirFrom.apply_to=t.apply_to?[t.apply_to]:[],r.addResFirFrom.start_time=t.start_time,r.addResFirFrom.study_time=t.study_time?t.study_time:"",r.currentId=t.id,r.resourceRadio=t.resource&&String(t.resource_id),r.nativeResourceRadio=t.resource&&String(t.resource_id),r.resourceType=t.resource&&t.resource.discriminator,r.dialogFormVisible=!0,r.resourceAction="update";case 25:case"end":return a.stop()}},a,r)}))()},openDelResDialog:function(e){this.syllabusid=e.course_syllabus_id,this.startType=e.resource?e.resource.discriminator:"",e.resource&&"legacy_live"===e.resource.discriminator?this.liveid=e.resource.live_id:this.liveid=0,this.currentId=e.id,this.dialogVisible=!0,this.deleteModule=!1},openDelOutlineDialog:function(e){this.currentId=e.id,this.dialogVisible=!0,this.deleteModule=!0},confirmDelete:function(){var e=this;return n()(s.a.mark(function t(){var r,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.currentId,e.delLoading=!0,a={course_syllabus_id:e.syllabus_id},t.next=5,e.$http.DeleteSyllabusItem(r,a);case 5:if(0!=t.sent.status){t.next=17;break}if(e.$message({message:"删除成功",type:"success"}),e.delLoading=!1,e.getSyllabusItems(),!e.startType||"legacy_live"!==e.startType){t.next=15;break}return t.next=13,e.$http.changeLive(e.liveid,0,e.syllabusid);case 13:0!=t.sent.status&&e.$message({message:"直播预约清除失败，请联系管理员",type:"warning"});case 15:t.next=17;break;case 17:e.dialogVisible=!1;case 18:case"end":return t.stop()}},t,e)}))()},openFirLvDialog:function(){this.adddialogVisible=!0,this.Moduledialog=!0,this.bigdislog=!0,this.ruleProject.name="",this.currentId="0"},addruleProject:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;1!=t.Moduledialog?(t.$refs[t.refname][0].innerText=t.ruleProject.name,t.adddialogVisible=!1):t.addbigCourse()})},addbigCourse:function(){var e=this;return n()(s.a.mark(function t(){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.btnLoading=!0,t.next=3,e.$http.CourseSyllabusItem({name:e.ruleProject.name,pid:e.currentId,course_syllabus_id:e.syllabus_id});case 3:r=t.sent,e.btnLoading=!1,0==r.status?(r.message="添加成功！",e.adddialogVisible=!1,e.currentId="0",e.getSyllabusItems()):r.message="添加失败！",e.$message({message:r.message,type:"success"});case 7:case"end":return t.stop()}},t,e)}))()},updateruleProject:function(e){var t,r=this;this.$refs[e].validate((t=n()(s.a.mark(function e(t){var a,i,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=11;break}return a=r.currentId,i={name:r.ruleProject.name,course_syllabus_id:r.syllabus_id},r.btnLoading=!0,e.next=6,r.$http.ChangeSyllabusItem(a,i);case 6:n=e.sent,r.btnLoading=!1,0==n.status?(r.$message({message:"修改成功！",type:"success"}),r.adddialogVisible=!1,r.getSyllabusItems()):r.$message.error("修改失败！"),e.next=12;break;case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,r)})),function(e){return t.apply(this,arguments)}))},editproject:function(e,t){this.currentId=e,this.ruleProject.name=t,this.adddialogVisible=!0,this.Moduledialog=!1},getSyllabusItems:function(){var e=this;return n()(s.a.mark(function t(){var r,a,i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$loading({lock:!0,text:"正在拼命获取课程大纲数据...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),a={syllabus_id:e.syllabus_id},t.next=4,e.$http.getGliveSyllabusItems(a);case 4:i=t.sent,r.close(),0==i.code?(i.result.forEach(function(e){e.two_level_subject&&0!=e.two_level_subject||(e.two_level_subject="")}),e.tabledata=i.result):e.$message({message:"获取课程大纲条目失败！"});case 7:case"end":return t.stop()}},t,e)}))()},checkSyllabus:function(){var e=this;return n()(s.a.mark(function t(){var r,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.checkSyllabus(e.syllabus_id);case 2:0==(r=t.sent).status&&(e.title=r.result.title,e.tag_id=r.result.tag_id,e.is_knowledge_open=0!==r.result.is_knowledge_open,e.project_id=r.result.project.id,e.isAllowUse=r.result.status,e.subject_id=r.result.subject.id,e.coursesylllevel=r.result.template.level_max,a={project_id:e.project_id,subject_id:e.subject_id},e.$http.getSubjectTwoList(a).then(function(t){0==t.status&&(e.erjiCourseOptions=t.result,t.result.forEach(function(t){"其他"==t.name&&(e.erjicourseId=t.two_level_subiect_id)}),e.getSyllabusItems())}));case 4:case"end":return t.stop()}},t,e)}))()},dragEnd:function(e){var t=this;return n()(s.a.mark(function e(){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.sortOptions&&t.sortOptions.parmas.near_by){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.$http.sortSyllabus(t.sortOptions.id,t.sortOptions.parmas);case 4:r=e.sent,t.sortOptions="",0==r.status?(t.message({type:"success",message:"排序成功！"}),t.getSyllabusItems()):t.message({type:"warning",message:"排序失败！"});case 7:case"end":return e.stop()}},e,t)}))()},onMoveCallback:function(e,t){var r=0;r=e.draggedContext.futureIndex>e.draggedContext.index?1:-1,this.sortOptions={id:e.draggedContext.element.id,parmas:{near_by:e.relatedContext.element&&e.relatedContext.element.id,direction:r,course_syllabus_id:this.syllabus_id}}},handleInputChange:function(e){""==e&&(this.videoForm.duration_second=0)},getVideoPath:function(){var e=this;return n()(s.a.mark(function t(){var r,a,i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object(u.b)(e.videoForm.video_id),a={url:r},t.next=4,e.$http.getVideoPath(a);case 4:return i=t.sent,t.abrupt("return",i);case 6:case"end":return t.stop()}},t,e)}))()},resetForm:function(e){this.$refs[e].resetFields()},getOutlineKnowledgeList:function(){var e=this;return n()(s.a.mark(function t(){var r,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={project_id:e.project_id,subject_id:e.subject_id},t.next=3,e.$http.getOutlineKnowledgeList(r);case 3:0===(a=t.sent).status&&(e.knowledgeList=a.result.result.contents);case 5:case"end":return t.stop()}},t,e)}))()},selectSubjectTwo:function(e,t,r){var a=this,s={name:r,course_syllabus_id:this.syllabus_id,two_level_subject:e};this.$http.ChangeSyllabusItem(t,s).then(function(e){0==e.status&&(a.$message({message:"切换二级科目成功！",type:"success"}),a.getSyllabusItems())})},addGliveAddr:function(e){var t=this;return n()(s.a.mark(function e(){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.gliveAddr="",e.next=3,t.$http.getLiveAddr(t.syllabus_id);case 3:r=e.sent,t.showAddGliveDialog=!0,t.gliveAddr=r.result.live_link;case 6:case"end":return e.stop()}},e,t)}))()},addGliveAddr1:function(e,t){var r=this;return n()(s.a.mark(function a(){var i;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r.gliveAddr1="",r.gliveAddr2="",a.next=4,r.$http.getPlaybackAddr(e);case 4:i=a.sent,r.showAddGliveDialog1=!0,r.playBackItem=e,r.itemResourceId=t,r.gliveAddr1=i.result.inst_replay,r.gliveAddr2=i.result.video_id;case 10:case"end":return a.stop()}},a,r)}))()},checkTime:function(e){var t=this;return n()(s.a.mark(function r(){var a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a={syllabus_id:t.syllabusid,start_time:e},"update"===t.resourceAction&&(a.item_id=t.resourceItemId),r.next=4,t.$http.getValidation(a);case 4:r.sent.result.Has&&t.$message({type:"warning",message:"您选择时间的时间段已有其他资源，请您确认！"});case 6:case"end":return r.stop()}},r,t)}))()},updateLiveAddr:function(){var e=this;return n()(s.a.mark(function t(){var r,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={syllabus_id:e.syllabus_id,live_link:e.gliveAddr},t.next=3,e.$http.updateLiveAddr(r);case 3:(a=t.sent)&&e.getSyllabusItems(),0==a.code?(e.$message.success("修改直播地址成功！"),e.showAddGliveDialog=!1):(e.$message.error("修改直播地址失败！"),e.showAddGliveDialog=!1);case 6:case"end":return t.stop()}},t,e)}))()},updatePlaybackAddr:function(){var e=this;return n()(s.a.mark(function t(){var r,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={syllabus_id:e.syllabus_id,item_id:e.playBackItem,inst_replay:e.gliveAddr1,video_id:e.gliveAddr2,relation_id:e.itemResourceId,discriminator:"live_playback_link"},t.next=3,e.$http.updatePlaybackAddr(r);case 3:(a=t.sent)&&e.getSyllabusItems(),0==a.code?(e.$message.success("修改回放地址成功！"),e.showAddGliveDialog1=!1):(e.$message.error("修改回放地址失败！"),e.showAddGliveDialog1=!1);case 6:case"end":return t.stop()}},t,e)}))()}},computed:{syllabus_id:function(){return this.$route.params.sid},resourceTypeList:function(){if(this.glive){if(1==this.addResFirFrom.type||3==this.addResFirFrom.type)return[{discriminator:"video",label:"视频"},{discriminator:"lecture_note",label:"讲义"},{discriminator:"paper",label:"试卷"}];if(2==this.addResFirFrom.type)return[{discriminator:"video",label:"视频"},{discriminator:"paper",label:"试卷"},{discriminator:"live_playback_link",label:"直播"}]}}},watch:{dialogFormVisible:function(e){e||(this.hasType2=!0)}},mounted:function(){for(var e=1;e<=120;e++)this.study_time_options.push({value:e})},created:function(){this.checkSyllabus(),this.glive=this.$route.query.glive||0}},v={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"module-edu-content permission-outlinemodule"},[r("el-row",{staticClass:"outlineeat"},[r("el-col",{attrs:{span:18}},[r("span",[e._v("课程大纲："+e._s(e.title))])]),e._v(" "),r("el-col",{attrs:{span:6}},[r("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.addGliveAddr}},[e._v("增加直播地址")])],1)],1),e._v(" "),r("div",{staticClass:"outlinebox"},[r("div",{staticClass:"chapterbox"},[e._m(0),e._v(" "),2===e.coursesylllevel?e._l(e.tabledata,function(t){return r("div",{key:t.id,staticClass:"first-chapter-box"},[r("div",{staticClass:"chaptit",on:{click:function(r){e.spread(t)}}},[r("span",{staticClass:"chlft"},[e.openArr.includes(t.id)?r("span",{staticClass:"el-icon-arrow-down",staticStyle:{"font-weight":"bold"}}):r("span",{staticClass:"el-icon-arrow-right",staticStyle:{"font-weight":"bold"}}),e._v("\n                    "+e._s(t.name)+" "),r("span",{staticClass:"gray"},[e._v("（条目ID："+e._s(t.id)+"） ")])]),e._v(" "),r("el-row",{staticClass:"chrgt",staticStyle:{width:"60px"}},[r("el-col",{attrs:{span:12}},[r("el-dropdown",{attrs:{trigger:"click"},nativeOn:{click:function(t){return e.handleSpread(t)}}},[r("span",{staticClass:"el-dropdown-link",staticStyle:{color:"#2CA4D9"}},[e._v("更多")]),e._v(" "),r("el-dropdown-menu",{staticStyle:{"margin-top":"0px"},attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{nativeOn:{click:function(r){e.copyId(t.id)}}},[r("span",{staticClass:"dropdown-child"},[e._v("复制条目ID")])]),e._v(" "),r("el-dropdown-item",{nativeOn:{click:function(r){e.openDelOutlineDialog(t)}}},[r("span",{staticClass:"dropdown-child"},[e._v("删除")])])],1)],1)],1)],1),e._v(" "),r("span",{staticClass:"chrgt",on:{click:function(r){r.stopPropagation(),e.editproject(t.id,t.name)}}},[e._v("修改")]),e._v(" "),r("span",{staticClass:"chrgt",staticStyle:{color:"#FF9C1C"},on:{click:function(r){r.stopPropagation(),e.openAddResDialog(t)}}},[e._v("新增资源")]),e._v(" "),4==e.project_id&&(40==e.subject_id||27==e.subject_id||26==e.subject_id||90==e.subject_id)||16==e.project_id&&(64==e.subject_id||65==e.subject_id)?r("el-select",{staticClass:"chrgt erji-course",attrs:{placeholder:"请选择二级科目"},on:{change:function(r){e.selectSubjectTwo(t.two_level_subject,t.id,t.name)}},model:{value:t.two_level_subject,callback:function(r){e.$set(t,"two_level_subject",r)},expression:"firstItem.two_level_subject"}},e._l(e.erjiCourseOptions,function(t){return r("el-option",{key:t.two_level_subiect_id,attrs:{label:"二级科目："+t.name,value:+t.two_level_subiect_id}},[r("span",{staticStyle:{display:"none"}},[e._v("二级科目：")]),e._v(" "),r("span",[e._v(e._s(t.name))])])})):e._e()],1),e._v(" "),r("div",e._l(t.children,function(a){return r("div",{key:a.id,staticClass:"resourcebox second-chapter-box"},[r("div",{staticClass:"knowledge"},[r("span",{staticClass:"chlft"},["2"==a.apply_to||"1"==a.apply_to?r("span",{staticClass:"dif-type"},[e._v(e._s("2"==a.apply_to?"提分盒子":"1"==a.apply_to?"跳级测试":""))]):e._e(),e._v(" "),r("span",{staticClass:"dif-type dif-type1",class:{"dif-type3":1==a.type||3==a.type}},[e._v(e._s(e._f("typeFormat")(a.type)))]),e._v(" \n                                "),r("span",{staticClass:"dif-type dif-type2",class:{"dif-type3":0==a.required}},[e._v(e._s(e._f("requiredFormat")(a.required)))]),e._v(" \n                                "),a.resource&&a.resource.discriminator&&"2"!=a.apply_to&&"1"!=a.apply_to?r("span",{staticClass:"dif-type"},[e._v(e._s(e._f("Resource2chn")(a.resource&&a.resource.discriminator)))]):e._e(),e._v(" \n                                "),a.audition&&"1"==a.audition?r("span",{staticClass:"audition"},[e._v("试听")]):e._e(),e._v("\n                                "+e._s(a.name)+"\n                                "),r("span",{staticClass:"gray"},[e._v("\n                                （条目ID："+e._s(a.id)),a.resource?[e._v(" 资源ID："+e._s(a.resource&&a.resource_id))]:e._e(),e._v("）\n                                    "),a.study_time&&"0"!=a.study_time&&a.resource&&"live_playback_link"==a.resource.discriminator?[r("span",{staticClass:"chline"},[e._v("|")]),e._v("建议学习："+e._s(a.study_time)+"分钟")]:e._e(),e._v(" "),a.start_time?r("span",{staticStyle:{color:"red","margin-left":"10px"}},[e._v("开启时间："+e._s(e._f("dateFormat")(a.start_time)))]):e._e()],2)]),e._v(" "),r("el-row",{staticClass:"chrgt",staticStyle:{width:"60px"}},[r("el-col",{attrs:{span:12}},[r("el-dropdown",{attrs:{trigger:"click"}},[r("span",{staticClass:"el-dropdown-link",staticStyle:{color:"#2CA4D9"}},[e._v("更多")]),e._v(" "),r("el-dropdown-menu",{staticStyle:{"margin-top":"0px"},attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{nativeOn:{click:function(t){e.copyId(a.id,a)}}},[r("span",{staticClass:"dropdown-child"},[e._v("复制条目/资源ID")])]),e._v(" "),r("el-dropdown-item",{nativeOn:{click:function(t){e.goPreview(a)}}},[r("span",{staticClass:"dropdown-child"},[e._v("预览")])]),e._v(" "),r("el-dropdown-item",{nativeOn:{click:function(t){e.openDelResDialog(a)}}},[r("span",{staticClass:"dropdown-child"},[e._v("删除")])])],1)],1)],1)],1),e._v(" "),r("span",{staticClass:"chrgt",on:{click:function(r){e.openeEditResource(t.id,a)}}},[e._v("修改")]),e._v(" "),a.resource&&"live_playback_link"==a.resource.discriminator?r("span",{staticClass:"chrgt",on:{click:function(t){e.addGliveAddr1(a.id,a.resource_id)}}},[e._v("添加回放地址")]):e._e()],1)])}))])}):e._e(),e._v(" "),r("div",{staticClass:"chaptit additem"},[r("span",{on:{click:e.openFirLvDialog}},[e._v("新增一级大纲目录")])])],2)]),e._v(" "),r("el-dialog",{staticClass:"tabplane addResourceDialog",attrs:{title:"选择学习资源",width:"60%",top:"2%",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-steps",{staticStyle:{"margin-top":"-10px","margin-bottom":"10px"},attrs:{active:e.active,"finish-status":"finish",simple:""}},e._l(e.progressText,function(e,t){return r("el-step",{key:t,attrs:{title:e.text,description:""}})})),e._v(" "),r("el-form",{directives:[{name:"show",rawName:"v-show",value:0==e.active,expression:"active == 0"}],ref:"addResFirFrom",staticClass:"demo-ruleForm",attrs:{model:e.addResFirFrom,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"显示名称",prop:"name",rules:e.filter_rules({required:!0,type:"isAllSpace",maxLength:100})}},[r("el-input",{staticClass:"coursetxt",nativeOn:{keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.firstNextSubmit("addResFirFrom")}},model:{value:e.addResFirFrom.name,callback:function(t){e.$set(e.addResFirFrom,"name",t)},expression:"addResFirFrom.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"学习环节",prop:"type",rules:e.filter_rules({required:!0,type:"isAllSpace"})}},[r("el-radio-group",{model:{value:e.addResFirFrom.type,callback:function(t){e.$set(e.addResFirFrom,"type",t)},expression:"addResFirFrom.type"}},[r("el-radio",{attrs:{label:1}},[e._v("课前")]),e._v(" "),e.hasType2?r("el-radio",{attrs:{label:2}},[e._v("课中")]):e._e(),e._v(" "),r("el-radio",{attrs:{label:3}},[e._v("课后")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"课程类型",prop:"required",rules:e.filter_rules({required:!0,type:"isAllSpace"})}},[r("el-radio-group",{model:{value:e.addResFirFrom.required,callback:function(t){e.$set(e.addResFirFrom,"required",t)},expression:"addResFirFrom.required"}},[r("el-radio",{attrs:{label:1}},[e._v("必修")]),e._v(" "),r("el-radio",{attrs:{label:0}},[e._v("选修")])],1)],1),e._v(" "),r("el-form-item",{staticClass:"coursebtn"},["add"===e.resourceAction?r("el-button",{staticStyle:{"margin-top":"12px"},attrs:{loading:e.onlySetLoading},on:{click:function(t){e.directSyllabus("addResFirFrom")}}},[e._v(e._s(e.onlySetLoading?"正在创建中":"只创建条目"))]):e._e(),e._v(" "),r("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary"},on:{click:function(t){e.firstNextSubmit("addResFirFrom")}}},[e._v("继续加资源")])],1)],1),e._v(" "),r("el-form",{directives:[{name:"show",rawName:"v-show",value:1==e.active,expression:"active == 1"}],ref:"addResFirFrom1",staticClass:"demo-ruleForm",attrs:{"label-width":"100px"}},[r("div",{staticClass:"selectmodel"},e._l(e.resourceTypeList,function(t,a){return r("span",{key:a,class:[e.resourceType==t.discriminator?"is-active":""],staticStyle:{position:"relative"},on:{click:function(r){e.selectclk(t.discriminator)}}},[e._v("\n          "+e._s(t.label)+"\n        ")])})),e._v(" "),2==e.addResFirFrom.type?r("el-form-item",{staticStyle:{"margin-top":"80px"},attrs:{label:"开启时间",rules:e.filter_rules({required:!0,type:"isAllSpace"})}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"请设置开启时间",format:"yyyy-MM-dd HH:mm"},on:{change:function(t){e.checkTime(e.addResFirFrom.start_time)}},model:{value:e.addResFirFrom.start_time,callback:function(t){e.$set(e.addResFirFrom,"start_time",t)},expression:"addResFirFrom.start_time"}})],1):e._e(),e._v(" "),"live_playback_link"===e.resourceType?r("el-form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"直播时长"}},[r("el-input",{staticStyle:{width:"220px"},model:{value:e.addResFirFrom.study_time,callback:function(t){e.$set(e.addResFirFrom,"study_time",t)},expression:"addResFirFrom.study_time"}}),e._v(" 分钟\n      ")],1):e._e(),e._v(" "),r("el-form-item",{staticClass:"coursebtn"},[r("el-button",{staticStyle:{"margin-top":"12px"},on:{click:e.prev}},[e._v("上一步")]),e._v(" "),"live_playback_link"===e.resourceType?r("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:function(t){e.addSyllabusResourceItem("live_playback_link")}}},[e._v(e._s(e.btnLoading?"新增中":"确 定")+"\n        ")]):r("el-button",{staticStyle:{"margin-top":"12px"},on:{click:function(t){e.secondSubmit("addResFirFrom1")}}},[e._v("下一步")])],1)],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:2==e.active,expression:"active == 2"}],staticClass:"rulemodule"},[r("el-form",{directives:[{name:"show",rawName:"v-show",value:"video"===e.resourceType||"lecture_note"===e.resourceType,expression:"resourceType === 'video' || resourceType === 'lecture_note'"}],attrs:{"label-position":"left","label-width":"80px"}},[r("el-form-item",{attrs:{label:"来源"}},[r("el-radio-group",{model:{value:e.sourceRadio,callback:function(t){e.sourceRadio=t},expression:"sourceRadio"}},[r("el-radio",{attrs:{label:1}},[e._v("上传/创建资源")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("从已有资源选择")])],1)],1)],1),e._v(" "),r("el-row",{directives:[{name:"show",rawName:"v-show",value:1===e.sourceRadio&&"lecture_note"===e.resourceType,expression:"sourceRadio === 1 && resourceType === 'lecture_note'"}]},[r("HandoutUpload",{ref:"handoutUpload",on:{getHandoutPath:e.getHandoutPath}})],1),e._v(" "),r("el-row",{directives:[{name:"show",rawName:"v-show",value:1===e.sourceRadio&&"video"===e.resourceType,expression:"sourceRadio === 1 && resourceType === 'video'"}]},[r("el-form",{ref:"videoForm",staticClass:"resource-ruleForm",attrs:{model:e.videoForm,"label-position":"left","label-width":"120px"}},[r("el-form-item",{attrs:{label:"视频地址",prop:"video_id",rules:e.filter_rules({required:!0,type:"isVideoId"})}},[r("el-input",{attrs:{placeholder:"请输入视频地址","auto-complete":"off"},model:{value:e.videoForm.video_id,callback:function(t){e.$set(e.videoForm,"video_id",t)},expression:"videoForm.video_id"}}),e._v(" "),r("el-tooltip",{attrs:{placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                只需要输入地址中不同部分即可,如示例:红色部分："),r("br"),e._v(e._s(e.urltip)+"\n                "),r("span",{staticStyle:{color:"red"}},[e._v("16oe3We00h1ye2hZ")]),e._v(e._s(e.urltip2))]),e._v(" "),r("i",{staticClass:"el-icon-info"})])],1),e._v(" "),r("el-form-item",{staticClass:"displayinline",attrs:{label:"视频时长（分）",prop:"duration_minutes",rules:[{required:!0,message:"请填写视频时长的分钟",trigger:"blur"}].concat(e.valiMinites)}},[r("el-input",{attrs:{placeholder:"请填写视频时长的分钟","auto-complete":"off"},on:{input:e.handleInputMinutesChange},model:{value:e.videoForm.duration_minutes,callback:function(t){e.$set(e.videoForm,"duration_minutes",t)},expression:"videoForm.duration_minutes"}}),e._v("\n            分\n          ")],1),e._v(" "),r("el-form-item",{staticClass:"displayinline",attrs:{label:"视频时长（秒）",prop:"duration_second",rules:e.valiSeconds}},[r("el-input",{attrs:{placeholder:"请填写视频时长的秒","auto-complete":"off"},on:{input:e.handleInputSecondChange,change:e.handleInputChange},model:{value:e.videoForm.duration_second,callback:function(t){e.$set(e.videoForm,"duration_second",t)},expression:"videoForm.duration_second"}}),e._v("\n            秒\n          ")],1)],1)],1),e._v(" "),r("el-row",{directives:[{name:"show",rawName:"v-show",value:2===e.sourceRadio,expression:"sourceRadio === 2"}]},[r("el-input",{attrs:{placeholder:e.inputPlaceholder,size:"small"},nativeOn:{keydown:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.handleIconClick(t):null}},model:{value:e.resourceinput,callback:function(t){e.resourceinput=t},expression:"resourceinput"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleIconClick},slot:"append"})],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.resLoading,expression:"resLoading"}],ref:"singleTable",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.resourceTable,border:"","tooltip-effect":"dark","max-height":"400","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange,"current-change":e.handleTableChange}},e._l(e.resourceTableConfig,function(t,a){return r("el-table-column",{key:a,attrs:{label:t.label,width:t.wh,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return["id"==t.key||"paper_id"==t.key||"live_id"==t.key?[r("el-radio",{staticClass:"radio",attrs:{label:String(a.row.id)},model:{value:e.resourceRadio,callback:function(t){e.resourceRadio=t},expression:"resourceRadio"}}),e._v(" "),r("span",[e._v(e._s(a.row[t.key]))])]:"discriminator"==t.key?r("span",[e._v(e._s(e._f("Resource2chn")(a.row[t.key])))]):r("span",[e._v(e._s(a.row[t.key]))])]}}])})})),e._v(" "),r("el-pagination",{attrs:{"current-page":e.pagination.current_page,"page-size":50,layout:"total, prev, pager, next, jumper",total:e.pagination.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.pagination,"current_page",t)}}})],1),e._v(" "),r("div",{staticClass:"coursebtn",staticStyle:{"padding-top":"0","margin-top":"20px"}},[r("el-button",{staticStyle:{"margin-top":"12px"},on:{click:e.prev}},[e._v("上一步")]),e._v(" "),"add"==e.resourceAction?r("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:e.addSyllabusResourceItem}},[e._v(e._s(e.btnLoading?"新增中":"确 定")+"\n        ")]):e._e(),e._v(" "),"update"==e.resourceAction?r("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:e.updateSyllabusResource}},[e._v(e._s(e.btnLoading?"新增中":"确 定")+"\n        ")]):e._e()],1)],1)],1),e._v(" "),r("el-dialog",{staticClass:"tabplane",attrs:{title:e.deleteModule?"删除课程大纲目录":"删除已选资源",visible:e.dialogVisible,size:"tiny"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("span",[e._v(e._s(e.deleteModule?"确定要删除该课程大纲目录吗？删除后，该目录下的子目录及资源关系均将被删除！":"确定要删除已选择的资源吗？"))]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.delLoading},on:{click:e.confirmDelete}},[e._v(e._s(e.delLoading?"删除中":"确 定"))])],1)]),e._v(" "),r("el-dialog",{staticClass:"tabplane",attrs:{title:e.Moduledialog?e.bigdislog?"新增一级大纲目录":"新增课程大纲子目录":"修改课程大纲名称",center:"",visible:e.adddialogVisible,size:"tiny"},on:{"update:visible":function(t){e.adddialogVisible=t}}},[r("el-form",{ref:"ruleProject",staticClass:"demo-ruleForm",attrs:{model:e.ruleProject,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"显示名称",prop:"name",rules:e.filter_rules({required:!0,type:"isAllSpace",maxLength:100})}},[r("el-input",{staticClass:"coursetxt",model:{value:e.ruleProject.name,callback:function(t){e.$set(e.ruleProject,"name",t)},expression:"ruleProject.name"}})],1)],1),e._v(" "),r("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.adddialogVisible=!1}}},[e._v("取 消")]),e._v(" "),1==e.Moduledialog?r("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:function(t){e.addruleProject("ruleProject")}}},[e._v(e._s(e.btnLoading?"新增中":"确 定")+"\n      ")]):r("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:function(t){e.updateruleProject("ruleProject")}}},[e._v("\n        "+e._s(e.btnLoading?"保存中":"保 存")+"\n      ")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"tabplane address-dialog",attrs:{title:"编辑CC平台直播地址",visible:e.showAddGliveDialog,size:"tiny"},on:{"update:visible":function(t){e.showAddGliveDialog=t}}},[r("el-input",{attrs:{placeholder:"请输入CC平台直播地址"},model:{value:e.gliveAddr,callback:function(t){e.gliveAddr=t},expression:"gliveAddr"}}),e._v(" "),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showAddGliveDialog=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.updateLiveAddr}},[e._v("确 定")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"tabplane address-dialog",attrs:{title:"编辑回放地址",visible:e.showAddGliveDialog1,size:"tiny"},on:{"update:visible":function(t){e.showAddGliveDialog1=t}}},[r("span",{staticClass:"address-t"},[e._v("实时回放地址")]),e._v(" "),r("el-input",{attrs:{placeholder:""},model:{value:e.gliveAddr1,callback:function(t){e.gliveAddr1=t},expression:"gliveAddr1"}}),e._v(" "),r("span",{staticClass:"address-t"},[e._v("回放视频地址")]),e._v(" "),r("el-input",{attrs:{placeholder:""},model:{value:e.gliveAddr2,callback:function(t){e.gliveAddr2=t},expression:"gliveAddr2"}}),e._v(" "),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showAddGliveDialog1=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.updatePlaybackAddr}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticStyle:{"font-size":"14px"}},[this._v("友情提醒：大纲中必须创建"),t("span",{staticStyle:{color:"red"}},[this._v("课中")]),this._v("环节，学员才可学习哦")])}]};var _=r("VU/8")(m,v,!1,function(e){r("t88T")},null,null);t.default=_.exports},YP0r:function(e,t,r){"use strict";var a=r("Xxa5"),s=r.n(a),i=r("exGp"),n=r.n(i),o=r("BK/k"),l=r("zSLJ"),c=r("NFfb"),u={computed:{materialUpload:function(){return Object(o.c)()+"apigateway.gaodun.com/resource-api/resource/file"}},data:function(){return{fileList:[],apiHeader:{},isUpload:!1,loading:!1}},methods:{clearAllFileList:function(){this.fileList=[]},beforeAvatarUpload:function(e){var t="pdf"===e.name.substring(e.name.lastIndexOf(".")+1);return t||this.$message({message:"上传文件只能是 pdf格式!",type:"warning"}),t},handleChange:function(e,t){this.fileList=t.slice(-1)},handleRemove:function(e,t){0==t.length&&(this.isUpload=!1,this.$emit("getHandoutPath","")),this.fileList=t},handleAvatarError:function(e,t,r){var a=this;this.loading=!1,this.$message.error("上传失败！"),setTimeout(function(){a.fileList=[]},0)},handleProgress:function(){this.loading=!0},uploadSuccess:function(e,t){var r=this;this.loading=!1,0===e.status?(this.isUpload=!0,this.$message({message:"文件上传成功",type:"success"}),this.$emit("getHandoutPath",e.result)):(this.isUpload=!1,setTimeout(function(){r.fileList=[]},0),this.$emit("getHandoutPath",""),this.$message({message:"文件上传失败",type:"warning"}))}},mounted:function(){},created:function(){var e=this;return n()(s.a.mark(function t(){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r="Basic "+Object(l.a)(c.j),e.apiHeader={Authentication:r};case 2:case"end":return t.stop()}},t,e)}))()}},d={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",[r("el-col",{attrs:{span:6}},[e._v("*选择文件：")]),e._v(" "),r("el-col",{attrs:{span:18}},[r("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"onUpload",staticClass:"syllabus-handout-upload",attrs:{headers:e.apiHeader,"file-list":e.fileList,drag:"","on-success":e.uploadSuccess,"on-change":e.handleChange,"on-remove":e.handleRemove,"on-progress":e.handleProgress,"on-error":e.handleAvatarError,"before-upload":e.beforeAvatarUpload,action:e.materialUpload,"element-loading-text":"正在上传中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.6)"}},[r("i",{staticClass:"el-icon-upload"}),e._v(" "),r("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或\n                "),r("em",[e._v("点击上传")])]),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("目前仅支持.pdf文件哦！")])])],1)],1)},staticRenderFns:[]};var p=r("VU/8")(u,d,!1,function(e){r("klCi")},null,null);t.a=p.exports},klCi:function(e,t){},t88T:function(e,t){},y1EW:function(e,t,r){"use strict";r.d(t,"a",function(){return a}),r.d(t,"c",function(){return s}),r.d(t,"b",function(){return i});var a=[{text:"资源设置",currentLine:"bar-line-current",currentDot:"bar-dot-current",currentText:"current-text",isCustomerConfirm:!0},{text:"资源类型",currentLine:"bar-line-current",currentDot:"bar-dot-current",currentText:"current-text",isCustomerConfirm:!1},{text:"资源选择",currentLine:"bar-line-current",currentDot:"bar-dot-current",currentText:"current-text",isCustomerConfirm:!1}],s=[{discriminator:"video",label:"视频"},{discriminator:"lecture_note",label:"讲义"},{discriminator:"paper",label:"试卷"},{discriminator:"legacy_live",label:"直播"},{discriminator:"resource_group",label:"资源组"}],i=[{discriminator:"video",table:[{key:"id",wh:"120",sort:!1,label:"资源ID"},{key:"discriminator",wh:"100",sort:!1,label:"资源类型"},{key:"title",wh:"",sort:!1,label:"资源名称"}],inputPlaceholder:"请输入视频资源ID / 名称",input:{}},{discriminator:"lecture_note",table:[{key:"id",wh:"120",sort:!1,label:"资源ID"},{key:"discriminator",wh:"100",sort:!1,label:"资源类型"},{key:"title",wh:"",sort:!1,label:"资源名称"}],inputPlaceholder:"请输入讲义资源ID / 名称",input:{}},{discriminator:"paper",table:[{key:"paper_id",wh:"100",sort:!1,label:"题库试卷ID"},{key:"discriminator",wh:"100",sort:!1,label:"资源类型"},{key:"title",wh:"",sort:!1,label:"资源名称"}],inputPlaceholder:"请输入题库试卷ID / 名称",input:{}},{discriminator:"legacy_live",table:[{key:"live_id",wh:"100",sort:!1,label:"直播ID"},{key:"discriminator",wh:"100",sort:!1,label:"资源类型"},{key:"title",wh:"",sort:!1,label:"资源名称"}],inputPlaceholder:"请输入直播ID / 名称",input:{}},{discriminator:"resource_group",table:[{key:"id",wh:"120",sort:!1,label:"资源组ID"},{key:"discriminator",wh:"100",sort:!1,label:"资源类型"},{key:"title",wh:"",sort:!1,label:"资源组名称"}],inputPlaceholder:"请输入资源组ID / 名称",input:{}}]}});
//# sourceMappingURL=6.f69d7444b7a7397df4ba.js.map